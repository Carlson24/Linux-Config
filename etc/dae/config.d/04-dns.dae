# See https://github.com/daeuniverse/dae/blob/main/docs/en/configuration/dns.md for full examples.
dns {
    # For example, if ipversion_prefer is 4 and the domain name has both type A and type AAAA records, the dae will only
    # respond to type A queries and response empty answer to type AAAA queries.
    #ipversion_prefer: 4

    # Give a fixed ttl for domains. Zero means that dae will request to upstream every time and not cache DNS results
    # for these domains.
    #fixed_domain_ttl {
    #    ddns.example.org: 10
    #    test.example.org: 3600
    #}

    # Bind to local address to listen for DNS queries
    # bind: '127.0.0.1:5353'
    # bind: 'tcp://127.0.0.1:5353'
    # bind: 'udp://127.0.0.1:5353'
    # bind: 'tcp+udp://127.0.0.1:5353'

    upstream {
        # Value can be scheme://host:port, where the scheme can be tcp/udp/tcp+udp/h3/http3/quic/https/tls.
        # If the protocol is h3/http3/https, it supports setting a custom path, that is, the format can be "protocol://host:port/custom path".
        # If host is a domain and has both IPv4 and IPv6 record, dae will automatically choose
        # IPv4 or IPv6 to use according to group policy (such as min latency policy).
        # Please make sure DNS traffic will go through and be forwarded by dae, which is REQUIRED for domain routing.
        # If dial_mode is "ip", the upstream DNS answer SHOULD NOT be polluted, so domestic public DNS is not recommended.

        alidns: 'udp://dns.alidns.com:53'
        googledns: 'tcp+udp://dns.google:53'

        # alih3: 'h3://dns.alidns.com:443'
        # alih3_path: 'h3://dns.alidns.com:443/dns-query'
        # alihttp3: 'http3://dns.alidns.com:443'
        # alihttp3_path: 'http3://dns.alidns.com:443/dns-query'
        # ali_quic: 'quic://dns.alidns.com:853'

        # h3_custom_path: 'h3://dns.example.com:443/custom-path'
        # http3_custom_path: 'http3://dns.example.com:443/custom-path'

        # ali_doh: 'https://dns.alidns.com:443'
        # ali_dot: 'tls://dns.alidns.com:853'

        # doh_custom_path: 'https://dns.example.com:443/custom-path'
    }
#     routing {
#         # According to the request of dns query, decide to use which DNS upstream.
#         # Match rules from top to bottom.
#         request {
#             # Lookup China mainland domains using alidns, otherwise googledns.
#             qname(geosite:cn) -> alidns
#             # fallback is also called default.
#             fallback: googledns
#         }
#     }
   routing {
       # According to the request of dns query, decide to use which DNS upstream.
       # Match rules from top to bottom.
       request {
           # fallback is also called default.
           fallback: alidns
       }
       # According to the response of dns query, decide to accept or re-lookup using another DNS upstream.
       # Match rules from top to bottom.
       response {
           # Trusted upstream. Always accept its result.
           upstream(googledns) -> accept
           # Possibly polluted, re-lookup using googledns.
           ip(geoip:private) && !qname(geosite:cn) -> googledns
           # fallback is also called default.
           fallback: accept
       }
   }
}
